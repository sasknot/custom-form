/*!*
 * jQuery Plugin: Custom Form Integration
 *
 *  @package    JS Plugins
 *  @category   jquery plugin
 *  @author     Rafael F. Silva <rafaelfsilva1@gmail.com>
 *  @link       /js/plugins/jquery.custom-form.js
 *  @since      14/01/2014
 *  @version    1.0.54
 *
 *  This plugin require other plugins to certain features work, like:
 *  custom select (select2), mask (maskedinput) and monetization (maskMoney).
 *
**/
!function(e){"use strict";var t={_setSettings:function(t,s){var a=e.extend({},e.fn.customForm.defaults,s);return"string"==typeof a.errorContainer&&(a.errorContainer=e(t).find(a.errorContainer)),a.dateFormat=a.dateFormat.toLowerCase(),a.dateRegExp=new RegExp("(("+a.dateFormat.replace("dd","(0[1-9]|[12][0-9]|3[01])").replace("mm","(0[13578]|1[02])").replace("yyyy","((1[0-9]|[2-9][0-9])[0-9]{2})").replace("yy","([0-9]{2})")+")|("+a.dateFormat.replace("dd","(0[1-9]|[12][0-9]|30)").replace("mm","(0[13456789]|1[012])").replace("yyyy","((1[0-9]|[2-9][0-9])[0-9]{2})").replace("yy","([0-9]{2})")+")|("+a.dateFormat.replace("dd","(0[1-9]|1[0-9]|2[0-8])").replace("mm","02").replace("yyyy","((1[0-9]|[2-9][0-9])[0-9]{2})").replace("yy","([0-9]{2})")+")|("+a.dateFormat.replace("dd","29").replace("mm","02").replace("yyyy","((1[6-9]|[2-9][0-9])(0[48]|[2468][048]|[13579][26])|((16|[2468][048]|[3579][26])00))").replace("yy","(0[048]|[2468][048]|[13579][26])")+"))","g"),a.timeFormat=a.timeFormat.toLowerCase(),a.timeRegExp=new RegExp(a.timeFormat.replace("hh","([01][0-9]|2[0-3])").replace(/mm|ss/g,"[0-5][0-9]"),"g"),e(t).data("settings",a),a},init:function(t,s){var a=e(t),i=this._setSettings(t,s);if(e(t).data("is-valid",!1),e.fn.mask&&(a.find('.field.date input[type="text"]').mask(i.dateFormat.replace(/[dmy]/g,"9")),a.find('.field.time input[type="text"]').mask(i.timeFormat.replace(/[hms]/g,"9")),a.find('.field.phone input[type="text"]').mask("99 99999999?9"),a.find('.field.cpf input[type="text"]').mask("999.999.999-99"),a.find('.field.cnpj input[type="text"]').mask("99.999.999/9999-99"),a.find('.field.cep input[type="text"]').mask("99999-999"),a.find('.field.carPlate input[type="text"]').mask("aaa-9999")),e.fn.maskMoney){var l={symbol:"R$",showSymbol:!0,symbolStay:!0,thousands:".",decimal:",",precision:2,defaultZero:!0,allowZero:!1,allowNegative:!1};a.find('.field.money input[type="text"]').each(function(){var t=e.extend(l,e(this).data("options")||{});e(this).maskMoney(t)}),a.find('.field.float input[type="text"]').each(function(){var t=e.extend(l,{symbol:"",thousands:""});e(this).maskMoney(t)})}e.fn.select2&&a.find('.field select[class*="select2"]').each(function(){var t=e(this).data("options")||{};e(this).hasClass("select2-no-search")&&(t.minimumResultsForSearch=-1),e(this).hasClass("select2-tags")&&(t.tags=[]),e(this).hasClass("select2-unique-selection")&&(t.multiple=!0,t.allowClear=!0,e(this).on("select2-selecting",function(t){var s=e(this).find('option[value="'+t.val+'"]').data("unique-key");e(this).find('option[data-unique="'+s+'"]').not('option[value="'+t.val+'"]').attr("disabled","disabled")}).on("select2-removed",function(t){var s=e(this).find('option[value="'+t.val+'"]').data("unique-key");e(this).find('option[data-unique="'+s+'"]').removeAttr("disabled")}));var s=e.extend({placeholder:!0,adaptContainerCssClass:function(){return""},containerCssClass:"select2-custom",dropdownCssClass:"select2-custom"},t);e(this).select2(s)}),a.find(".field.state select, .field.target select").change(function(){var t=e(e(this).data("target")),s=e(this).data("request-url");if(t&&s&&""!==e(this).val()){for(var a=t.attr("placeholder")||t.data("placeholder"),i=[e(this).val()],l=this;e('[data-target="#'+l.id+'"]').length>0;)l=e('[data-target="#'+l.id+'"]').get(0),i.unshift(e(l).val());e.ajax({url:s+i.join("/"),dataType:"json",beforeSend:function(){t.html('<option value=""></option>').attr("placeholder","Carregando..."),e.fn.select2&&t.select2("val","")},success:function(s){var i='<option value=""></option>';e.each(s,function(e,t){i+='<option value="'+e+'">'+t+"</option>"}),t.html(i),t.attr("placeholder")?t.attr("placeholder",a):t.data("placeholder",a),t.data("initial-value")&&t.val(t.data("initial-value")),e.fn.select2&&(t.select2("val","").select2("close"),t.data("initial-value")&&t.select2("val",t.data("initial-value")));for(var l=t;l.closest(".field").hasClass("target");)l=e(l.data("target")),l.html('<option value=""></option>'),e.fn.select2&&l.select2("val","").select2("close")}})}}).on("select2-clearing",function(){var t=e(e(this).data("target"));t.html('<option value=""></option>').select2("val","").select2("close");for(var s=t;s.closest(".field").hasClass("target");)s=e(s.data("target")),s.html('<option value=""></option>'),e.fn.select2&&s.select2("val","").select2("close")}),a.on("submit",function(t){e(this).customForm("validate",{success:function(t){var s=e(this),a=e(t);s.find('input[type="submit"]').attr("disabled",!0),a.find(".sending").show(),s.hasClass("ajaxForm")&&e.ajax({url:this.action,type:this.method||"POST",data:s.serialize(),dataType:"json",beforeSend:function(){a.find(".return").removeClass("success error").html("")},success:function(t){a.find("p").hide(),t?(t.message&&a.find(".return").addClass(t.error?"error":"success").html(t.message).show(),(t.url||t.redirect)&&(window.location.href=t.url||t.redirect),t.data&&s.trigger("ajax-callback",t.data),t.error===!1&&t.clear&&(s.find('input[type="text"], input[type="password"], input[type="email"], input[type="date"], input[type="file"], select:not(.select2), textarea').val(""),s.find('input[type="checkbox"], input[type="radio"]').attr("checked",!1).parent().removeClass("selected"),e.fn.select2&&s.find('select[class*="select2"]').select2("val","",!0),s.find(".field[data-initial-classes]").each(function(){e(this).removeClass().addClass(e(this).data("initial-classes"))}))):a.find(".sendError").show().find("span").text("null")},error:function(e,t){a.find("p").hide(),a.find(".sendError").show().find("span").text(t)},complete:function(){s.find('input[type="submit"]').removeAttr("disabled")}})}}),(e(this).hasClass("ajaxForm")||!e(this).data("is-valid"))&&t.preventDefault()})},validate:function(t,s){var a=e(t).data("settings")||this._setSettings(t,s.options||{}),i=a.errorContainer,l=!1,n="."+a.requiredClass+":not([disabled])",r=e(t).find("input, select, textarea").filter(n);a.ignoreInvisible&&(r=r.closest(".field").filter(":visible").find("input, select, textarea").filter(":visible").filter(n)),a.dateRegExp.lastIndex=0,a.timeRegExp.lastIndex=0,r.each(function(){"INPUT"==this.tagName&&("text"==this.type||"password"==this.type)&&""===this.value&&e(this).closest(".field").hasClass("depends")===!1&&e(this).closest(".field").hasClass("dependsNot")===!1||"INPUT"==this.tagName&&"file"==this.type&&(""===this.value||e(this).closest(".field").hasClass(a.errorClass))||"INPUT"==this.tagName&&"text"==this.type&&e(this).closest(".field").hasClass("date")&&(""===this.value||!a.dateRegExp.test(this.value))||"INPUT"==this.tagName&&e(this).closest(".field").hasClass("time")&&(""===this.value||!a.timeRegExp.test(this.value))||"INPUT"==this.tagName&&("text"==this.type||"email"==this.type)&&e(this).closest(".field").hasClass("email")&&(""===this.value||!/^[a-zA-Z0-9][a-zA-Z0-9\._-]+@([a-zA-Z0-9\._-]+\.)[a-zA-Z-0-9]{2}/.test(this.value))||"INPUT"==this.tagName&&("text"==this.type||"url"==this.type)&&e(this).closest(".field").hasClass("url")&&(""===this.value||!/(http:\/\/)?(www)([a-zA-Z0-9\._-]+\.)[a-zA-Z-0-9]{2,3}/.test(this.value))||"INPUT"==this.tagName&&e(this).closest(".field").hasClass("cpf")&&(""===this.value||!function(e){var t,s,a,i,l,n;if(e=e.replace(/[^0-9]/g,""),n=1,e.length<11)return!1;for(i=0;i<e.length-1;i++)if(e.charAt(i)!=e.charAt(i+1)){n=0;break}if(n)return!1;for(t=e.substring(0,9),s=e.substring(9),a=0,i=10;i>1;i--)a+=t.charAt(10-i)*i;if(l=2>a%11?0:11-a%11,l!=s.charAt(0))return!1;for(t=e.substring(0,10),a=0,i=11;i>1;i--)a+=t.charAt(11-i)*i;return l=2>a%11?0:11-a%11,l!=s.charAt(1)?!1:!0}(this.value))||e(this).closest(".field").hasClass("equalsTo")&&(0===e(this).val().length||e(this).val()!=e(e(this).data("equals-to")).val())||e(this).closest(".field").hasClass("depends")&&e(e(this).data("depends")).is(":checked")&&0===e(this).val().length||e(this).closest(".field").hasClass("dependsNot")&&e(e(this).data("depends")).is(":checked")===!1&&0===e(this).val().length||"INPUT"==this.tagName&&"checkbox"==this.type&&this.checked===!1||"INPUT"==this.tagName&&"radio"==this.type&&0===e(this).closest("form").find('[name="'+this.name+'"]:checked').length||"TEXTAREA"==this.tagName&&""===e(this).val()||"SELECT"==this.tagName&&(void 0===e(this).val()||null===e(this).val()||""===e(this).val()||e(this).val().length&&0===e(this).val().length)&&e(this).closest(".field").hasClass("depends")===!1&&e(this).closest(".field").hasClass("dependsNot")===!1?(l=!0,e(this).closest(".field").addClass(a.errorClass)):e(this).closest(".field").removeClass(a.errorClass)}),i.find("p").hide(),l?(e(t).data("is-valid",!1),i.find(".invalid").show()):(e(t).data("is-valid",!0),s.success&&s.success.apply(t,i))},destroy:function(t){e(t).data("settings",!1),e(t).off("submit")}};e.fn.customForm=function(s){if(t[s]){var a="object"==typeof arguments[1]?arguments[1]:{};return this.each(function(){t[s].call(t,this,a)})}return"object"!=typeof s&&s?void e.error("Method "+s+" does not exist on jQuery customForm"):this.each(function(){t.init.call(t,this,s)})},e.fn.customForm.defaults={requiredClass:"required",errorClass:"error",errorContainer:".messages",ignoreInvisible:!0,dateFormat:"dd/mm/yyyy",timeFormat:"hh:mm:ss"}}(jQuery);